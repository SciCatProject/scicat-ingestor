
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://scicatproject.github.io/scicat-ingestor/25.05.0/user-guide/metadata-schemas/" rel="canonical"/>
<link href="../offline-ingestor/" rel="prev"/>
<link href="../../developer-guide/getting-started/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.13" name="generator"/>
<title>Metadata Schema - Scicat Ingestor</title>
<link href="../../assets/stylesheets/main.342714a4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="light-blue" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#metada-schemas">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Scicat Ingestor" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Scicat Ingestor">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Scicat Ingestor
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Metadata Schema
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../getting-started/">
        
  
  
    
  
  Getting Started

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../overview/">
          
  
  
  User Guide

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../developer-guide/getting-started/">
          
  
  
  Developer Guide

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Scicat Ingestor" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Scicat Ingestor">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Scicat Ingestor
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/">
<span class="md-ellipsis">
    Getting Started
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-ellipsis">
    User Guide
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../overview/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../configuration/">
<span class="md-ellipsis">
    Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../online-ingestor/">
<span class="md-ellipsis">
    OnlineIngestor
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../offline-ingestor/">
<span class="md-ellipsis">
    OfflineIngestor
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Metadata Schema
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Metadata Schema
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#content-structure">
<span class="md-ellipsis">
      Content Structure
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example">
<span class="md-ellipsis">
      Example
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metadata-schema-retrieval-flow">
<span class="md-ellipsis">
      Metadata Schema Retrieval Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#schema-definition-general-information">
<span class="md-ellipsis">
      Schema Definition (General Information)
    </span>
</a>
<nav aria-label="Schema Definition (General Information)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#selector-example">
<span class="md-ellipsis">
      Selector Example
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#variable-set-instruction">
<span class="md-ellipsis">
      Variable Set Instruction
    </span>
</a>
<nav aria-label="Variable Set Instruction" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#example_1">
<span class="md-ellipsis">
      Example
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#variable-definition">
<span class="md-ellipsis">
      Variable definition
    </span>
</a>
<nav aria-label="Variable definition" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#value-types">
<span class="md-ellipsis">
      Value Types
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#sources">
<span class="md-ellipsis">
      Sources
    </span>
</a>
<nav aria-label="Sources" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#nxs-nexus">
<span class="md-ellipsis">
      NXS (nexus)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#value">
<span class="md-ellipsis">
      VALUE
    </span>
</a>
<nav aria-label="VALUE" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#value-operators">
<span class="md-ellipsis">
      Value Operators
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#sc-scicat">
<span class="md-ellipsis">
      SC (SciCat)
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scicat-dataset-population-instruction">
<span class="md-ellipsis">
      Scicat Dataset Population Instruction
    </span>
</a>
<nav aria-label="Scicat Dataset Population Instruction" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#field-assignment">
<span class="md-ellipsis">
      Field assignment
    </span>
</a>
<nav aria-label="Field assignment" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#high-level-field">
<span class="md-ellipsis">
      High Level Field
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scientific-metadata">
<span class="md-ellipsis">
      Scientific Metadata
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Developer Guide
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../developer-guide/getting-started/">
<span class="md-ellipsis">
    Getting Started
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developer-guide/documentation/">
<span class="md-ellipsis">
    Documentation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developer-guide/adrs/">
<span class="md-ellipsis">
    ADRs
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developer-guide/configuration/">
<span class="md-ellipsis">
    Configuration
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#content-structure">
<span class="md-ellipsis">
      Content Structure
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example">
<span class="md-ellipsis">
      Example
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metadata-schema-retrieval-flow">
<span class="md-ellipsis">
      Metadata Schema Retrieval Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#schema-definition-general-information">
<span class="md-ellipsis">
      Schema Definition (General Information)
    </span>
</a>
<nav aria-label="Schema Definition (General Information)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#selector-example">
<span class="md-ellipsis">
      Selector Example
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#variable-set-instruction">
<span class="md-ellipsis">
      Variable Set Instruction
    </span>
</a>
<nav aria-label="Variable Set Instruction" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#example_1">
<span class="md-ellipsis">
      Example
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#variable-definition">
<span class="md-ellipsis">
      Variable definition
    </span>
</a>
<nav aria-label="Variable definition" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#value-types">
<span class="md-ellipsis">
      Value Types
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#sources">
<span class="md-ellipsis">
      Sources
    </span>
</a>
<nav aria-label="Sources" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#nxs-nexus">
<span class="md-ellipsis">
      NXS (nexus)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#value">
<span class="md-ellipsis">
      VALUE
    </span>
</a>
<nav aria-label="VALUE" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#value-operators">
<span class="md-ellipsis">
      Value Operators
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#sc-scicat">
<span class="md-ellipsis">
      SC (SciCat)
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scicat-dataset-population-instruction">
<span class="md-ellipsis">
      Scicat Dataset Population Instruction
    </span>
</a>
<nav aria-label="Scicat Dataset Population Instruction" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#field-assignment">
<span class="md-ellipsis">
      Field assignment
    </span>
</a>
<nav aria-label="Field assignment" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#high-level-field">
<span class="md-ellipsis">
      High Level Field
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scientific-metadata">
<span class="md-ellipsis">
      Scientific Metadata
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="metada-schemas">Metada Schemas</h1>
<p><code>scicat-ingestor</code> parses or computes metadata from ingested dataset.<br/>
<code>schema files</code> are a set of directives of how to collect/compute the metadata.<br/>
The directives include <code>where(from which source - file, scicat or the schema itself, etc...)</code> to retrieve the information and <code>how</code> to compute/parse the information.
Using the directives, <code>scicat-ingestor</code> populate the dataset entry in <code>SciCat</code>.</p>
<p>In more detail, each schema file contains following information:
|   |   |
| - | - |
| schema selection | When to apply the schema to the file |
| variables definition | How to construct a <code>local variable set</code>, i.e. variable <code>pid</code> is the string from <code>/entry/entry_identifier_uuid</code> in the nexus file. |
| dataset creation | How to populate fields in a SciCat dataset using the <code>local variable set</code> |</p>
<p>The schema files are written in <code>json</code> format and all have <code>imsc.json</code> extension.<br/>
<code>imsc</code> stands for SciCat <code>i</code>ngestor <code>m</code>etadata <code>sc</code>hema.<br/>
Each schema file has mandatory fields.</p>
<h2 id="content-structure">Content Structure</h2>
<p>An <code>imsc</code> file has three main sections, <em>general</em>, <em>variables</em> and <em>schemas</em>.</p>
<table>
<thead>
<tr>
<th>Section</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>general</em></td>
<td>A group of fields including <code>unique id</code>, <code>name of the schema</code>, <code>which instrument</code> it's associated with<br/>and the matching-criteria that tells which file is relevant to this schema. <br/> See <a href="#schema-definition-general-information">schema definition (general information)</a> for more information.</td>
</tr>
<tr>
<td><em>variables</em></td>
<td>A set of <code>key-value</code> pairs retrieved from multiple sources.<br/>They are later used in the schema section.<br/>See <a href="#variable-set-instruction">variable set instruction</a> for more information.</td>
</tr>
<tr>
<td><em>schema</em></td>
<td>A set of instructions how to populate <code>SciCat</code> dataset fields using <code>variables</code>.<br/>See <a href="#scicat-dataset-population-instruction">SciCat dataset population instruction</a> for more information.</td>
</tr>
</tbody>
</table>
<h2 id="example">Example</h2>
<p>This is an example of schema file:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;NUMBER&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;UNIQUE_STRING&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;NAME_OF_THE_SCHEMA&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"instrument"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;COMMA_SEPARATED_LIST_OF_INSTRUMENTS_NAMES&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"selector"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;OBJECT_WITH_SELECTION_RULES&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"variables"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"&lt;VARIABLE_NAME&gt;"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;VARIABLE_DEFINITION&gt;"</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"schemas"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"&lt;MNEMONIC_ENTRY_NAME&gt;"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;SCHEMA_ENTRY_DEFINITION&gt;"</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="metadata-schema-retrieval-flow">Metadata Schema Retrieval Flow</h2>
<pre class="mermaid"><code>---
title: Metadata Retrieval Flow Chart
---
flowchart TB

    subgraph matching [Schema Matching]
        direction TB
        load-schema[Load Schema FIles] --&gt; files@{shape: docs, label: "Sorted Schema Files by order"}
        files --&gt; select[Next Schema File]
        select --&gt; cur-schema@{shape: notch-rect, label: "Current Schema File"}
        cur-schema --&gt; match{Match?<br/>*using selector*}
        input-file@{shape: lean-l, label: "Input Nexus File"} --&gt; match
        match --&gt; |Yes| matched
        match --&gt; |No| select
        select --&gt; |Nothing Matched| no-match@{shape: loop-limit, label: "Fall back to the default schema definition"}
        matched --&gt; |Current Schema Definition| selected@{shape: notch-rect, label: "Selected Schema"}
        no-match --&gt; |Default Schema Definition| selected
    end

    subgraph variables [Schema Variable Set]
        direction TB
        selected --&gt; variable-definitions@{shape: docs, label: "Variable Definitions"}
        variable-definitions --&gt; build-variable-set[Build Variable Key-Value Pairs]
        build-variable-set --&gt; local-variable-set@{shape: docs, label: "Local Variable Set"}
    end

    subgraph dataset [Metadata Dataset]
        direction TB
        selected --&gt; dataset-definitions@{shape: docs, label: "Dataset Definitions"}
        local-variable-set --&gt; dto@{shape: docs, label: "Dataset Transfer Object (DTO)"}
        dataset-definitions --&gt; dto
    end

</code></pre>
<h2 id="schema-definition-general-information">Schema Definition (General Information)</h2>
<p>The first several fields of <code>imsc</code> files, that are not <code>variables</code> or <code>schemas</code>, contain meta data of the schema file for admins and data-curators to identify the schema. <br/>
For ingestor, it contains the fields for ordering and matching schema files with the input data file to be ingested.</p>
<table>
<thead>
<tr>
<th>Field Name</th>
<th>Field Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>string</td>
<td>Unique id of the schema. Subsequent version of the same schema should have different ids.<br/> <code>uuid</code> is recommended, but there are not restrictions on the format.</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Human readable name. <em>This field is only for admin to assign a meaningful name for the configuration.</em></td>
</tr>
<tr>
<td>instrument</td>
<td>string</td>
<td>A list of relevant instrument names separated by comma(<code>,</code>).</td>
</tr>
<tr>
<td>order</td>
<td>integer</td>
<td>The order of the schemas. Ingestor sorts the schemas using the value of the <code>order</code>. The lower the order is, the earlier the schema is evaluated for applicability. In case a file matches multiple schema selector, the schema with lower order number will be used.</td>
</tr>
<tr>
<td>selector</td>
<td>dict(object) | string</td>
<td>A set of conditions for the schema to be matched with the input file.</td>
</tr>
</tbody>
</table>
<h3 id="selector-example">Selector Example</h3>
<p>Example 1:
The schema will be applied to files whose full path start with <code>/ess/data/coda</code> or <code>/ess/raw/coda</code>
<div class="highlight"><pre><span></span><code><span class="nt">"selector"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"or"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">"filename:starts_with:/ess/data/coda"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"filename:starts_with:/ess/raw/coda"</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Example 2:
The schema will be applied to files whose file name contains the word <code>coda</code>.
<div class="highlight"><pre><span></span><code><span class="nt">"selector"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"filename:contains:coda"</span>
</code></pre></div></p>
<p>Multiple selectors can be combined with <code>and</code> and <code>or</code> operators.<br/>
Each selector can be a single string with three parts divided by colon(<code>:</code>), called <code>condensed selector</code>, or an object with the three equivalent fields, called <code>expanded selector</code>. <br/></p>
<p>The three components of each selector are:
- source of the value to use of the first operand
- operator
- second operand.</p>
<p>The syntax of the <code>condensed selector</code>:
<div class="highlight"><pre><span></span><code><span class="s2">"source_op_1:operator:op_2"</span>
</code></pre></div></p>
<p>The syntax of the <code>expanded selector</code>:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="nt">"source"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;SOURCE_OF_THE_FIRST_OPERAND&gt;"</span><span class="p">,</span>
<span class="nt">"operator"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;OPERATOR&gt;"</span><span class="p">,</span>
<span class="nt">"operand_2"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;OPERAND_2&gt;"</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Available Source Names:</p>
<table>
<thead>
<tr>
<th>Source Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>filename</td>
<td>Path to the input file (provided as input argument with option <em>--nexus-file</em>)</td>
</tr>
<tr>
<td>datafile</td>
<td>same as <code>filename</code></td>
</tr>
<tr>
<td>nexusfile</td>
<td>same as <code>filename</code></td>
</tr>
</tbody>
</table>
<p>Available Operators:</p>
<table>
<thead>
<tr>
<th>Operator Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>starts_with</td>
<td>the value retrieved from the source should start with  <em>operand_2</em></td>
</tr>
<tr>
<td>contains</td>
<td>the value retrieved from the source should contain <em>operand_2</em></td>
</tr>
</tbody>
</table>
<p>Operand two is always interpreted as string.</p>
<h2 id="variable-set-instruction">Variable Set Instruction</h2>
<p><code>variables</code> section of the <code>imsc</code> file is a set of variable definitions.<br/>
It can contain as many definitions as the user needs in order to populate the metadata.<br/></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The order of the definitions in the section is important, as the ingestor will follow it.<br/>
Variables defined earlier can be used to define later ones.</p>
</div>
<h3 id="example_1">Example</h3>
<p><code>variables</code> section should look like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">"variables"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">"&lt;VARIABLE_NAME_1&gt;"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;VARIABLE_DEFINITION_1&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"&lt;VARIABLE_NAME_2&gt;"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;VARIABLE_DEFINITION_2&gt;"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p><code>offline-ingestor</code> will store these key-value pairs in memory and will use them for evaluating the <code>schema</code> section to populate <code>SciCat</code> dataset.</p>
<p>For example, given the following variables structure:
<div class="highlight"><pre><span></span><code><span class="nt">"variables"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">"job_id"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VALUE"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"26e95e54"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"value_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"owner_group"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VALUE"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"group_&lt;proposal_id&gt;"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"value_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"access_groups"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VALUE"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"group_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"group_2"</span><span class="p">],</span>
<span class="w">    </span><span class="nt">"value_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string[]"</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>The variables stored in memory will look like this:
<div class="highlight"><pre><span></span><code>"variables" : {
  "job_id": "26e95e54",
  "owner_group": "group_26e95e54",
  "access_groups": ["group_1", "group_2"],
}
</code></pre></div></p>
<h3 id="variable-definition">Variable definition</h3>
<p>Each variable definition has the following structure:
<div class="highlight"><pre><span></span><code><span class="nt">"&lt;variable_name&gt;"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;source_of_value: NXS|SC|VALUE&gt;"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"value_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;type_of_value: string|dict|list|date|ingeter|string[]&gt;"</span><span class="p">,</span>
<span class="w">    </span><span class="err">...addi</span><span class="kc">t</span><span class="err">io</span><span class="kc">nal</span><span class="w"> </span><span class="kc">f</span><span class="err">ields...</span>
<span class="p">}</span>
</code></pre></div></p>
<p>This definition will define a variable of name  <em><code>variable_name</code></em> of type <em><code>type_of_value</code></em> <br/>
and the value of such variable will be retrieved from <em><code>source_of_value</code></em>. <br/>
Additional fields might be required depending on the <code>source</code>.</p>
<h4 id="value-types">Value Types</h4>
<p>The field <em>value_type</em> accept the following options:</p>
<table>
<thead>
<tr>
<th>Type Name</th>
<th>Dtype in <code>python</code></th>
<th>Dtype in <code>typescript</code></th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>string</td>
<td>str</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>string[]</td>
<td>list[str]</td>
<td>array[string]</td>
<td></td>
</tr>
<tr>
<td>list</td>
<td>list</td>
<td>array</td>
<td></td>
</tr>
<tr>
<td>dict</td>
<td>dict</td>
<td>object</td>
<td></td>
</tr>
<tr>
<td>integer</td>
<td>int</td>
<td>int</td>
<td></td>
</tr>
<tr>
<td>float</td>
<td>float</td>
<td>float</td>
<td></td>
</tr>
<tr>
<td>date</td>
<td>str</td>
<td>string</td>
<td>ISO8601 format</td>
</tr>
<tr>
<td>email</td>
<td>str</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>link</td>
<td>str</td>
<td>string</td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>value types are not necessarily <code>dtype</code>.
For example, <code>date</code> specifies not only the dtype but also the regex that it should be a datetime in <code>ISO8601</code> format.</p>
</div>
<p>Available <code>value-types</code> can be found in <code>_DtypeConvertingMap</code> in <code>scicat_dataset</code> module.</p>
<h4 id="sources">Sources</h4>
<p>Currently, the source field only accepts the following options:</p>
<table>
<thead>
<tr>
<th>Source Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>NXS</td>
<td>The nexus file specified as input argument with the option <code>--nexus-file</code>, i.e. the data file.</td>
</tr>
<tr>
<td>SC</td>
<td>The api of the SciCat instance of reference which the ingestor is configured to interact with the configuration option <em>scicat.host</em>.</td>
</tr>
<tr>
<td>VALUE</td>
<td>A static value specified directly in the definition</td>
</tr>
</tbody>
</table>
<p>Available <code>sources</code> can be found in <code>scicat_metadata</code> module. <br/>
Here is more detailed description how to define variables from each <code>source</code>.</p>
<h5 id="nxs-nexus">NXS (nexus)</h5>
<p>A variable is retrieved from the nexus data file to be ingested. <br/></p>
<p>Syntax:
<div class="highlight"><pre><span></span><code><span class="nt">"&lt;variable_name&gt;"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NXS"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;nexus_path&gt;"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"value_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;type_of_value&gt;"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></p>
<p>It means that the variable <em><code>variable_name</code></em> of type <em><code>type_of_value</code></em> will be retrieved from the <em><code>nexus_path</code></em> in the nexus file.</p>
<p>Example:
<div class="highlight"><pre><span></span><code>"job_id": {
    "source": "NXS",
    "path": "/entry/entry_identifier_uuid",
    "value_type": "string"
},
</code></pre></div>
The variable <em><code>job_id</code></em> is parsed as a <code>string</code> from the nexus file at <em><code>/entry/entry_identifier_uuid</code></em>.</p>
<h5 id="value">VALUE</h5>
<p>A variable value is directly defined in the definition itself. <br/></p>
<p>Syntax:
<div class="highlight"><pre><span></span><code><span class="nt">"&lt;variable_name&gt;"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VALUE"</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="nt">"operator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;OPERATOR_NAME&gt;"</span><span class="p">,]</span>
<span class="w">    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;variable_value&gt;"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"value_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;type_of_value&gt;"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
It means thatthe variable <em><code>variable_name</code></em> of type <em><code>type_of_value</code></em> has the value, <em><code>variable_value</code></em>.
Additionally if the field <code>operator</code> is specified, the operator <em><code>operator_name</code></em> is applied to the value.<br/>
The variable value can reference other variables that are previously defined i.e. <code>"&lt;variable_name&gt;"</code>. <br/>
Any matching variables between <code>&lt;&gt;</code> will be resolved by the ingestor.</p>
<p>Example 1:
<div class="highlight"><pre><span></span><code>"pid": {
    "source": "VALUE",
    "value": "20.500.12269/23c40f04-de76-11ef-897f-bb426f5f764f",
    "value_type": "string"
},
</code></pre></div>
A variable named <em><code>pid</code></em> has the value of <em><code>20.500.12269/23c40f04-de76-11ef-897f-bb426f5f764f</code></em> of dtype <em><code>string</code></em>.</p>
<p>Example 2:
<div class="highlight"><pre><span></span><code>"pid": {
    "source": "VALUE",
    "value": "20.500.12269/&lt;job_id&gt;",
    "value_type": "string"
},
</code></pre></div>
If there is variable <em><code>job_id</code></em> is with a <em><code>string</code></em> value, <em><code>cc59b538-de76-11ef-b192-d3d4305b1b90</code></em>, <br/>
the variable <em><code>pid</code></em> will have the value of <em><code>20.500.12269/cc59b538-de76-11ef-b192-d3d4305b1b90</code></em> of type <em><code>string</code></em>. <br/></p>
<h6 id="value-operators">Value Operators</h6>
<p>A value definition can contain an additional field <em><code>operator</code></em> which specifies an operator to be applied to the value.<br/>
Depending on the <code>operator</code>, <code>variable definition</code> may need extra fields.<br/>
The current list of the operators available with their functionality is the following:</p>
<table>
<thead>
<tr>
<th>Operator Name</th>
<th>Functionality</th>
<th>Mandatory Extra Fields</th>
</tr>
</thead>
<tbody>
<tr>
<td>getitem</td>
<td>Assuming the value is a <code>list</code> or a <code>dict</code>, select an element by the key, <code>field</code>.</td>
<td><code>field</code></td>
</tr>
<tr>
<td>str_replace</td>
<td>Replace a pattern with a string within the value.</td>
<td><code>pattern</code>, <code>replacement</code></td>
</tr>
<tr>
<td>to_upper</td>
<td>Convert the value to upper case</td>
<td></td>
</tr>
<tr>
<td>to_lower</td>
<td>Convert the value to lower case</td>
<td></td>
</tr>
<tr>
<td>urlsafe</td>
<td>Convert the value to a safe format to be used in a url</td>
<td></td>
</tr>
<tr>
<td>join_with_space</td>
<td>Assuming the value is an array, joins all the elements of the array with a space as separating character as a single string</td>
<td></td>
</tr>
<tr>
<td>dirname</td>
<td>Assuming the value is a file system path, returns the parent folder. <br/>It effectively eliminates the last element of the path.</td>
<td></td>
</tr>
<tr>
<td>dirname-2</td>
<td>Assuming the value is a file system path, returns the grand-parent folder <br/>It effectively eliminates the last two elements of the path.</td>
<td></td>
</tr>
<tr>
<td>filename</td>
<td>Assuming the value is a file system path, returns the file name of the path.</td>
<td></td>
</tr>
<tr>
<td>DO_NOTHING</td>
<td>Returns the value itself.<br/>It is useful when you want to use the same value for multiple variables.</td>
<td></td>
</tr>
</tbody>
</table>
<p>Here are examples of some complex operators that have extra fields:</p>
<ul>
<li>getitem</li>
</ul>
<p>If there is an existing variable <code>proposal_data</code> like this:
  <div class="highlight"><pre><span></span><code><span class="n">local_variables</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"proposal_data"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"pi_firstname"</span> <span class="p">:</span> <span class="s2">"John"</span><span class="p">,</span>
      <span class="s2">"pi_lastname"</span> <span class="p">:</span> <span class="s2">"Doe"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>The following variable definition will resolve to a variable <em><code>pi_firstname</code></em> with value <code>"John"</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nt">"pi_firstname"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VALUE"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"operator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"getitem"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;proposal_data&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"field"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pi_firstname"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"value_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>str_replace</li>
</ul>
<p>If there is an existing variable <code>raw_folder</code> like this:
  <div class="highlight"><pre><span></span><code><span class="n">local_variables</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"raw_folder"</span><span class="p">:</span> <span class="s2">"/ess/raw/instrument/year/proposal"</span><span class="p">}</span>
</code></pre></div></p>
<p>The following variable definition will resolve to a variable <em><code>source_folder</code></em> with value <code>"/ess/data/instrument/year/proposal"</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nt">"source_folder"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VALUE"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"operator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"str-replace"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;raw_folder&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ess/raw"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"replacement"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ess/data"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"value_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span>
<span class="p">},</span>
</code></pre></div>
<h5 id="sc-scicat">SC (SciCat)</h5>
<p>A variable is retrieved from a SciCat instance. <br/></p>
<p>Syntax:
<div class="highlight"><pre><span></span><code>"&lt;VARIABLE_NAME&gt;" : {
    "source": "SC",
    "url": "&lt;ENDPOINT_URL&gt;",
    "field" : "&lt;NAME_OF_THE_FIELD&gt;
    "value_type": "&lt;TYPE_OF_VALUE&gt;",
}
</code></pre></div>
It means a variable of  <em><code>variable_name</code></em> of type <em><code>type_of_value</code></em> will have the value
retrieved from the <code>SciCat</code> instance, with the endpoint specified by the field <code>url</code>.<br/>
If <code>field</code> is specified, it will extract the exact field from the results, otherwise it will assign the full object returned by scicat.<br/>
The url is relative to the <code>SciCat</code> instance endpoint in the <a href="../configuration/#scicat-scicat"><code>configuration</code></a>.</p>
<p>Example:
<div class="highlight"><pre><span></span><code>"proposal_data": {
  "source": "SC",
  "url": "proposals/&lt;proposal_id&gt;",
  "field" : "",
  "value_type": "dict"
},
</code></pre></div></p>
<p>The ingestor will put through a <code>GET</code> request to the endpoint <code>proposals</code> with <em><code>proposal_id</code></em>. <br/>
<em><code>proposal_id</code></em> should be defined already.<br/>
<code>SciCat</code> should return a <code>dict</code> object containing all the information regarding the <code>proposal</code>.<br/>
The variable <em>proposal_data</em> will have the returned object as its value.</p>
<h2 id="scicat-dataset-population-instruction">Scicat Dataset Population Instruction</h2>
<p>Under the <code>schema</code> section of the imsc file, <code>ingestor</code> finds how to populate the SciCat dataset fields using <a href="#variable-set-instruction"><code>variables</code></a>.<br/>
<code>schema</code> section can contain arbitrary number of dataset definitions.<br/>
<em>The order of scicat dataset definitions is not important.</em></p>
<p>Syntax:
<div class="highlight"><pre><span></span><code><span class="nt">"schema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">"&lt;ASSIGNMENT_NAME_1&gt;"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;FIELD_ASSIGNMENT_1&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"&lt;ASSIGNMENT_NAME_2&gt;"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;FIELD_ASSIGNMENT_2&gt;"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></p>
<blockquote>
<p>The names for the dataset definition, i.e. <code>"&lt;ASSIGNMENT_NAME&gt;"</code>, are not used by the ingestor. <br/>
They are meant to be human readable for the data curator.</p>
</blockquote>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="nt">"schema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">"pid"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"field_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"high_level"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"machine_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pid"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;pid&gt;"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"field_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"high_level"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"machine_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"type"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"raw"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"proposal_id"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"field_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"high_level"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"machine_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"proposalId"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;proposal_id&gt;"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"dataset_name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"field_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"high_level"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"machine_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"datasetName"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;dataset_name&gt;"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>The dataset <code>pid</code> will use the variable <em><code>pid</code></em> as a value, <br/>
the dataset <code>type</code> will have a value of <code>"raw"</code>, <br/>
the dataset <code>proposalId</code> will use the variable <em><code>proposal_id</code></em> as a value, <br/>
and the dataset <code>datasetName</code> will use the variable <em><code>dataset_name</code></em> as a value.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>variable</code> name should be wrapped in <code>&lt;&gt;</code> so that <code>ingestor</code> recognizes it as a variable.</p>
</div>
<h3 id="field-assignment">Field assignment</h3>
<p>There are two types of scicat dataset definition:</p>
<ul>
<li>high level field</li>
<li>scientific metadata field</li>
</ul>
<p>Each definition type is described in the following sub sections:</p>
<h4 id="high-level-field">High Level Field</h4>
<p>Syntax:
<div class="highlight"><pre><span></span><code><span class="nt">"&lt;ASSIGNMENT_NAME&gt;"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">"field_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"high_level"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"machine_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;SCICAT_DATASET_FIELD&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;FIELD_VALUE&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;FIELD_TYPE&gt;"</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Dataset definition <code>&lt;ASSIGNMENT_NAME&gt;</code> will have value <code>&lt;FIELD_VALUE&gt;</code> of type <code>&lt;FIELD_TYPE&gt;</code>. <br/>
<code>&lt;SCICAT_DATASET_FIELD&gt;</code> is the field name in the SciCat dto(data transfer object). <br/>
Invalid field name will cause an error and the dataset entry will not be created by the <code>SciCat</code> backend.</p>
<p>Example with static value:
<div class="highlight"><pre><span></span><code><span class="nt">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">"field_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"high_level"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"machine_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"type"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"raw"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span>
<span class="p">},</span>
</code></pre></div>
This assignment will assign the value <code>"raw"</code> to the dataset field <code>type</code>.</p>
<p>Example using variable:
<div class="highlight"><pre><span></span><code><span class="nt">"creation_location"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">"field_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"high_level"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"machine_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"creationLocation"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ESS:CODA:&lt;instrument_name&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span>
<span class="p">},</span>
</code></pre></div></p>
<p>Assuming that variable <em><code>instrument_name</code></em> has the value <code>dream</code>, <br/>
<code>createLocation</code> field in the dto will have the value, <code>"ESS:CODE:dream"</code>.</p>
<h4 id="scientific-metadata">Scientific Metadata</h4>
<p>Syntax:
<div class="highlight"><pre><span></span><code><span class="nt">"&lt;ASSIGNMENT_NAME&gt;"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">"field_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scientific_metadata"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"machine_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;SCIENTIFIC_METADATA_MACHINE_FIELD_NAME&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"human_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;SCIENTIFIC_METADATA_HUMAN_FIELD_NAME&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;FIELD_VALUE&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;VALUE_TYPE&gt;"</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Ingestor will create a scientific metadata entry <em><code>assignment_name</code></em>, <br/>
named <code>&lt;SCIENTIFIC_METADATA_MACHINE_FIELD_NAME&gt;</code> (which is machine consumable) <br/>
with a value of <code>&lt;FIELD_VALUE&gt;</code> of type <code>&lt;VALUE_TYPE&gt;</code>. <br/>
It will also add the optional field <code>human_name</code> with the value <code>&lt;SCIENTIFIC_METADATA_HUMAN_FIELD_NAME&gt;</code>. which will appear in the <code>SciCat</code> frontend.</p>
<p>Example 1:
<div class="highlight"><pre><span></span><code><span class="nt">"start_time"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">"field_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scientific_metadata"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"machine_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"start_time"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"human_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Start Time"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;start_time&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date"</span>
<span class="p">},</span>
<span class="nt">"end_time"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">"field_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"scientific_metadata"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"machine_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"end_time"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"human_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"End Time"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;end_time&gt;"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date"</span>
<span class="p">},</span>
</code></pre></div></p>
<p>Assuming that variable <em><code>start_time</code></em> has value <code>"2025-01-20 12:00:00"</code> <br/>
and variable <em><code>end_time</code></em> has value <code>"2025-01-20 12:30:00"</code>, <br/>
the scientific metadata object will look like this:</p>
<div class="highlight"><pre><span></span><code><span class="s2">"scientific_metadata"</span> <span class="p">{</span>
  <span class="s2">"start_time"</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">"value"</span> <span class="p">:</span> <span class="s2">"2025-01-20 12:00:00"</span>
    <span class="s2">"unit"</span> <span class="p">:</span> <span class="s2">""</span>
    <span class="s2">"human_name"</span> <span class="p">:</span> <span class="s2">"Start time"</span>
    <span class="s2">"type"</span> <span class="p">:</span> <span class="s2">"date"</span>
  <span class="p">},</span>
  <span class="s2">"end_time"</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">"value"</span> <span class="p">:</span> <span class="s2">"2025-01-20 12:30:00"</span>
    <span class="s2">"unit"</span> <span class="p">:</span> <span class="s2">""</span>
    <span class="s2">"human_name"</span> <span class="p">:</span> <span class="s2">"End time"</span>
    <span class="s2">"type"</span> <span class="p">:</span> <span class="s2">"date"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "navigation.tabs", "navigation.tabs.sticky", "content.tooltips", "content.code.copy"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
<script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script></body>
</html>
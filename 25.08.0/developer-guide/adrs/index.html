
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://scicatproject.github.io/scicat-ingestor/25.08.0/developer-guide/adrs/" rel="canonical"/>
<link href="../documentation/" rel="prev"/>
<link href="../configuration/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.14" name="generator"/>
<title>ADRs - Scicat Ingestor</title>
<link href="../../assets/stylesheets/main.342714a4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="light-blue" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#architecture-decision-records">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Scicat Ingestor" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Scicat Ingestor">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Scicat Ingestor
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              ADRs
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/SciCatProject/scicat-ingestor/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../getting-started/">
        
  
  
    
  
  Getting Started

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../user-guide/overview/">
          
  
  
  User Guide

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../getting-started/">
          
  
  
  Developer Guide

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Scicat Ingestor" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Scicat Ingestor">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Scicat Ingestor
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/SciCatProject/scicat-ingestor/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/">
<span class="md-ellipsis">
    Getting Started
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    User Guide
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/overview/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/configuration/">
<span class="md-ellipsis">
    Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/online-ingestor/">
<span class="md-ellipsis">
    OnlineIngestor
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/offline-ingestor/">
<span class="md-ellipsis">
    OfflineIngestor
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/metadata-schemas/">
<span class="md-ellipsis">
    Metadata Schema
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
<span class="md-ellipsis">
    Developer Guide
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../getting-started/">
<span class="md-ellipsis">
    Getting Started
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../release-deploy/">
<span class="md-ellipsis">
    Release and Deployment
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../documentation/">
<span class="md-ellipsis">
    Documentation
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    ADRs
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    ADRs
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#adr-000-decouple-continuous-discovery-process-and-individual-dataset-ingestion-process">
<span class="md-ellipsis">
      ADR-000: Decouple continuous discovery process and individual dataset ingestion process.
    </span>
</a>
<nav aria-label="ADR-000: Decouple continuous discovery process and individual dataset ingestion process." class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#advantages">
<span class="md-ellipsis">
      Advantages
    </span>
</a>
<nav aria-label="Advantages" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#smaller-tests">
<span class="md-ellipsis">
      Smaller Tests
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smaller-usage">
<span class="md-ellipsis">
      Smaller Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#multi-processes-with-central-control">
<span class="md-ellipsis">
      Multi Processes with Central Control
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#less-configurations">
<span class="md-ellipsis">
      Less Configurations
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#easier-maintenance">
<span class="md-ellipsis">
      Easier Maintenance
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration">
<span class="md-ellipsis">
      Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#visualization-of-architecture">
<span class="md-ellipsis">
      Visualization of Architecture
    </span>
</a>
<nav aria-label="Visualization of Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ingestor-flow-chart-bird-eye-view">
<span class="md-ellipsis">
      Ingestor Flow Chart - Bird Eye View
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ingestor-flow-chart-detail">
<span class="md-ellipsis">
      Ingestor Flow Chart - Detail
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adr-001-use-dataclass-instead-of-jinja-or-dict-to-create-datasetdata-block-instances">
<span class="md-ellipsis">
      ADR-001: Use dataclass instead of jinja or dict to create dataset/data-block instances.
    </span>
</a>
<nav aria-label="ADR-001: Use dataclass instead of jinja or dict to create dataset/data-block instances." class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#reason-for-not-using-dict">
<span class="md-ellipsis">
      Reason for not using dict
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reason-for-not-using-jinja">
<span class="md-ellipsis">
      Reason for not using jinja
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reason-for-using-dataclassesdataclass">
<span class="md-ellipsis">
      Reason for using dataclasses.dataclass
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#downside-of-using-dataclass-instead-of-jinja">
<span class="md-ellipsis">
      Downside of using dataclass instead of jinja
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adr-002-use-yaml-instead-of-json-for-metadata-schema-and-ingestor-configuration">
<span class="md-ellipsis">
      ADR-002: Use yaml instead of json for metadata schema and ingestor configuration.
    </span>
</a>
<nav aria-label="ADR-002: Use yaml instead of json for metadata schema and ingestor configuration." class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#reason">
<span class="md-ellipsis">
      Reason
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#downside">
<span class="md-ellipsis">
      Downside
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#supporting-tool-for-transition">
<span class="md-ellipsis">
      Supporting Tool for Transition
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../configuration/">
<span class="md-ellipsis">
    Configuration
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#adr-000-decouple-continuous-discovery-process-and-individual-dataset-ingestion-process">
<span class="md-ellipsis">
      ADR-000: Decouple continuous discovery process and individual dataset ingestion process.
    </span>
</a>
<nav aria-label="ADR-000: Decouple continuous discovery process and individual dataset ingestion process." class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#advantages">
<span class="md-ellipsis">
      Advantages
    </span>
</a>
<nav aria-label="Advantages" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#smaller-tests">
<span class="md-ellipsis">
      Smaller Tests
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#smaller-usage">
<span class="md-ellipsis">
      Smaller Usage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#multi-processes-with-central-control">
<span class="md-ellipsis">
      Multi Processes with Central Control
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#less-configurations">
<span class="md-ellipsis">
      Less Configurations
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#easier-maintenance">
<span class="md-ellipsis">
      Easier Maintenance
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration">
<span class="md-ellipsis">
      Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#visualization-of-architecture">
<span class="md-ellipsis">
      Visualization of Architecture
    </span>
</a>
<nav aria-label="Visualization of Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ingestor-flow-chart-bird-eye-view">
<span class="md-ellipsis">
      Ingestor Flow Chart - Bird Eye View
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ingestor-flow-chart-detail">
<span class="md-ellipsis">
      Ingestor Flow Chart - Detail
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adr-001-use-dataclass-instead-of-jinja-or-dict-to-create-datasetdata-block-instances">
<span class="md-ellipsis">
      ADR-001: Use dataclass instead of jinja or dict to create dataset/data-block instances.
    </span>
</a>
<nav aria-label="ADR-001: Use dataclass instead of jinja or dict to create dataset/data-block instances." class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#reason-for-not-using-dict">
<span class="md-ellipsis">
      Reason for not using dict
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reason-for-not-using-jinja">
<span class="md-ellipsis">
      Reason for not using jinja
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#reason-for-using-dataclassesdataclass">
<span class="md-ellipsis">
      Reason for using dataclasses.dataclass
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#downside-of-using-dataclass-instead-of-jinja">
<span class="md-ellipsis">
      Downside of using dataclass instead of jinja
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adr-002-use-yaml-instead-of-json-for-metadata-schema-and-ingestor-configuration">
<span class="md-ellipsis">
      ADR-002: Use yaml instead of json for metadata schema and ingestor configuration.
    </span>
</a>
<nav aria-label="ADR-002: Use yaml instead of json for metadata schema and ingestor configuration." class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#reason">
<span class="md-ellipsis">
      Reason
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#downside">
<span class="md-ellipsis">
      Downside
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#supporting-tool-for-transition">
<span class="md-ellipsis">
      Supporting Tool for Transition
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="architecture-decision-records">Architecture Decision Records</h1>
<p>Here we keep records of important software architecture decisions and the reasonabouts.</p>
<h2 id="adr-000-decouple-continuous-discovery-process-and-individual-dataset-ingestion-process">ADR-000: Decouple continuous discovery process and individual dataset ingestion process.</h2>
<p><code>scicat ingestor</code> has two main responsibilities:
    - Continuous discovery of a new dataset with related files
    - Individual dataset ingestion from the discovery</p>
<p>Previously (&lt;25.01.0) <code>scicat ingestor</code> was single process program that continuously processes messages and files in a loop.
In other words, both responsibilities were deelpy coupled.</p>
<p>As the <code>scicat ingestor</code> under went project wide refactoring, <br/>
we decided to decouple those responsibilities(functionalities) and extract individual dataset ingestion as an independent tool.</p>
<h3 id="advantages">Advantages</h3>
<p>Here are some of advantages we discovered as we decoupled the discovery process and ingestion process.</p>
<h4 id="smaller-tests">Smaller Tests</h4>
<p>A single program, as it was initially, was hard to test and also to maintain.
For example, we had to send <code>kafka</code> message to trigger the ingestion and make the ingestor parse <code>metadata</code> from files just to test if it can ingest file to <code>scicat</code> accordingly.
If they are decoupled we can split this huge test into three smaller tests:
    - <code>kafka</code> message processing
    - <code>metadata</code> extraction
    - <code>scicat</code> ingestion
This decoupling helps to implement faster unittests/integration tests on a smaller scope.</p>
<h4 id="smaller-usage">Smaller Usage</h4>
<p>As the dataset ingestion is now an completely independently tool from the discovery process, we can easily run ingestion multiple times in case of error.</p>
<h4 id="multi-processes-with-central-control">Multi Processes with Central Control</h4>
<p>Discovery process(online ingestor) spawns a sub process to start the ingestion process and continue listening to the next dataset.
In reality, <code>online ingestor</code> spawns multiple processes to start <code>offline ingestor</code> as it could take a few seconds or even a few minutes depending on the metadata it needs to compute.
Even if one of processes fails due to faulty metadata or unexpected structure of dataset, it will not affect the rest of healthy files and ingestions as it is on a separate process.</p>
<h4 id="less-configurations">Less Configurations</h4>
<p>As the ingestion process(<code>offline ingestor</code>) now do not communicate with kafka anymore,
it can use subset of <code>online ingestor</code> configurations,
which makes it easier to go through the list of the configurations dedicated to <code>offline ingestor</code>.</p>
<h4 id="easier-maintenance">Easier Maintenance</h4>
<p>Due to all advantages we mentioned above, the maintenance cost considerably reduced.
It takes less for testing, hence less time to release the software.</p>
<h3 id="configuration">Configuration</h3>
<p><code>online-ingestor</code> runs the <code>offline-ingestor</code> so the configuration of <code>offline-ingestor</code> can be a subset of the configuration of <code>online-ingestor</code>.</p>
<p><span class="arithmatex"><span class="MathJax_Preview">Configuration(online) \subset Configuration(offline)</span><script type="math/tex">Configuration(online) \subset Configuration(offline)</script></span></p>
<p>However, instead of passing individual configurations to the offline ingestor via command arguments, we simply pass the whole configuration file that <code>online-ingestor</code> was called with, to the <code>offline-ingestor</code> as it is much easier.</p>
<p>Because it is not so practical to maintain two different json files when they are almost identica. Therefore we compromised to keep only one json file, which has all configuration options both for <code>online-ingestor</code> and <code>offline-ingestor</code>.</p>
<p>So the configuration file became union set of two different configurations.</p>
<p><span class="arithmatex"><span class="MathJax_Preview">Configuration = Configuration(online) \cup Configuration(offline)</span><script type="math/tex">Configuration = Configuration(online) \cup Configuration(offline)</script></span></p>
<h3 id="visualization-of-architecture">Visualization of Architecture</h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These diagrams might be updated and be different from the first design.</p>
</div>
<h4 id="ingestor-flow-chart-bird-eye-view">Ingestor Flow Chart - Bird Eye View</h4>
<!-- Mermaid chart does not support different shapes for subgraph-->
<!-- And we wanted make the offline ingestor as `processes` shape -->
<!-- As there will be multiple processes of them. -->
<!-- So we made svg image of the diagram instead using mermaid. -->
<!-- It very likely that they will support different shapes for subgraph in the future though...! -->
<p><img alt="image" src="../../_mermaid_charts/_ingestor_flow_birdeyeview.svg"/></p>
<h4 id="ingestor-flow-chart-detail">Ingestor Flow Chart - Detail</h4>
<pre class="mermaid"><code>---
title: Ingestor Flow Chart - Detail
---
flowchart LR

    subgraph online [Online Ingestor]
        direction TB
        connect-to-kafka[Connect to Kafka Cluster] --&gt; subscription[Subscribe to Instrument Topics]
        subscription --&gt; wait[Wait for Next Messages]
        wait --&gt; done{{Done Writing Message?}}
        done --&gt; |No| wait
        done --&gt; |Yes| max-process{{Maximum Offline Ingestor Running?}}
        max-process --&gt; |Yes| wait-running@{ shape: delay , label: "Wait for previous ingestors"}
        wait-running --&gt; max-process
        max-process --&gt; |No| start@{shape: circle, label: "Start Offline Ingestor"}
        start --&gt; wait
    end

    subgraph offline [Offline Ingestor]
        direction TB
        start-offline@{shape: circle, label: "Start Offline Ingestor"}
        start-offline --&gt; load-schema[Load Schema]
        load-schema --&gt; select[Select Schema]
        select --&gt; open[Open Nexus File, Event Data]
        open --&gt; variable[Define Variables]
        variable --&gt; populate[Populate Local Dataset]
        populate --&gt; create[Create Dataset on Scicat]
        create --&gt; create-origdataset[Create OrigDataset on Scicat]
        create-origdataset --&gt; stop@{shape: dbl-circ, label: "Finish Offline Ingestor"}

    end

    online --&gt; offline

    style start fill:green,stroke-width:4px,opacity:0.5;
    style start-offline fill:green,stroke-width:4px,opacity:0.5;

</code></pre>
<h2 id="adr-001-use-dataclass-instead-of-jinja-or-dict-to-create-datasetdata-block-instances">ADR-001: Use <code>dataclass</code> instead of <code>jinja</code> or <code>dict</code> to create dataset/data-block instances.</h2>
<p>We need a dict-like template to create dataset/data-block instances via scicat APIs.</p>
<h3 id="reason-for-not-using-dict">Reason for not using <code>dict</code></h3>
<p>It used to be implemented with <code>dict</code> but it didn't have any verifying layer so anyone could easily break the instances without noticing or causing errors in the upstream layers.</p>
<h3 id="reason-for-not-using-jinja">Reason for not using <code>jinja</code></h3>
<p><code>Jinja</code> template could handle a bit more complicated logic within the template, i.e. <code>for</code> loop or <code>if</code> statement could be applied to the variables.
However, the dataset/data-block instances are not complicated to utilize these features of <code>jinja</code>.</p>
<h3 id="reason-for-using-dataclassesdataclass">Reason for using <code>dataclasses.dataclass</code></h3>
<p>First we did try using <code>jinja</code> but the dataset/data-block instances are simple enough so we replaced <code>jinja</code> template with <code>dataclass</code>.
<code>dataclass</code> can verify name and type (if we use static checks) of each field.
It can be easily turned into a nested dictionary using <code>dataclasses.asdict</code> function.</p>
<h3 id="downside-of-using-dataclass-instead-of-jinja">Downside of using <code>dataclass</code> instead of <code>jinja</code></h3>
<p>With <code>jinja</code> template, certain fields could be skipped based on a variable.
However, it is not possible in the dataclass so it will need extra handling after turning it to a dictionary.
For example, each datafile item can have <code>chk</code> field, but this field shouldn't exist if checksum was not derived.
With jinja template we could handle this like below
<div class="highlight"><pre><span></span><code><span class="x">{</span>
<span class="x">    "path": "</span><span class="cp">{{</span> <span class="nv">path</span> <span class="cp">}}</span><span class="x">",</span>
<span class="x">    "size": </span><span class="cp">{{</span> <span class="nv">size</span> <span class="cp">}}</span><span class="x">,</span>
<span class="x">    "time": "</span><span class="cp">{{</span> <span class="nv">time</span> <span class="cp">}}</span><span class="x">",</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">chk</span> <span class="cp">%}</span><span class="x">"chk": "</span><span class="cp">{{</span> <span class="nv">chk</span> <span class="cp">}}</span><span class="x">"</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">}</span>
</code></pre></div>
However, with dataclass this should be handled like below.
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">asdict</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DataFileItem</span><span class="p">:</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">time</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">chk</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">data_file_item</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">asdict</span><span class="p">(</span><span class="n">DataFileItem</span><span class="p">(</span><span class="s1">'./'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'00:00'</span><span class="p">))</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">!=</span><span class="s1">'chk'</span> <span class="ow">or</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><h1> No Multi-type Arguments </h1>
We decided <strong>NOT</strong> to support <strong>multiple types of arguments/configuration option</strong> due to this ADR.
It is not impossible to support it, but the advantange is not worth the effort of handling multiple types.
Especially it makes the auto generator of json configuration file much more difficult than how it is now.</p>
<p>For example, there can be multiple kafka brokers so in principle we could allow a list of string as an argument type or a single string value.
However we decided to keep it only as a string, and if multiple brokers are needed, user should write them joined by comma(,).
On the other hand, access group option is always <code>list</code> even if there may be only one access group.</p>
</div>
<h2 id="adr-002-use-yaml-instead-of-json-for-metadata-schema-and-ingestor-configuration">ADR-002: Use <code>yaml</code> instead of <code>json</code> for metadata schema and ingestor configuration.</h2>
<blockquote>
<p>Use <code>yaml</code> for human-interacting configuration files and <code>json</code> for communication between processes or services.</p>
</blockquote>
<h3 id="reason">Reason</h3>
<p><code>Yaml</code> has better human readability compared to <code>json</code> and allows <code>comments</code>.<br/>
It will be much easier with commenting allowed to share configuration details and context with other maintainers.</p>
<p>We decided to make schema files modular.<br/>
It means service maintainers can build complicated metadata schema without duplicating schema files.<br/>
That means it should be easy to track intention/context of each module.<br/>
So <code>comments</code> feature of configuration file was prioritized to the robustness/performance of parsing the configuration.</p>
<h3 id="downside">Downside</h3>
<p>Parsing <code>Yaml</code> can be much slower than <code>json</code> if we have too complex structure.<br/>
However, we will avoid such structure of configuration as it is mainly written by human.</p>
<p>Another downside is that <code>Yaml</code> is less secure than <code>json</code> due to its flexibility.<br/>
Service maintainers are expected to keep these configuration/schema files in a secured isolated environment<br/>
and we implement extra safety/validation layers of configuration/schema files in the relevant places.<br/>
For example, <code>yaml</code> must be loaded with <code>safe_load</code> method.</p>
<h3 id="supporting-tool-for-transition">Supporting Tool for Transition</h3>
<p>We were already using <code>json</code> in our production environment so to make the transition smoother,<br/>
we implemented a tool that can translate <code>json</code> to <code>yaml</code> easily.</p>
<div class="highlight"><pre><span></span><code>scicat_json_to_yaml<span class="w"> </span>--input-file<span class="w"> </span>PATH/TO/THE/JSON/FILE
</code></pre></div>
<p>It can be used for any configuration or schema files.</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "navigation.tabs", "navigation.tabs.sticky", "content.tooltips", "content.code.copy"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
<script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script></body>
</html>